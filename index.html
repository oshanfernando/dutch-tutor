<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Dutch-English Flipcard">
    <meta name="description" content="A Dutch-English flashcard game for learning vocabulary.">
    <meta name="theme-color" content="#ffffff">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    <title>Dutch-English Flipcard Game</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
            font-size: clamp(24px, 5vw, 36px);
        }

        .setup-screen {
            max-width: 500px;
            margin: 0 auto;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #4a5568;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            min-width: 44px;
            min-height: 44px;
            touch-action: manipulation;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .connect-btn {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            margin-top: 10px;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #e53e3e;
        }

        .success {
            background: #c6f6d5;
            color: #22543d;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #38a169;
        }

        .day-selector {
            margin: 30px 0;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .day-btn {
            padding: 15px;
            text-align: left;
            background: white;
            border: 2px solid #e2e8f0;
            color: #4a5568;
            font-size: clamp(14px, 2.5vw, 16px);
        }

        .day-btn:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .day-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .progress-info {
            font-size: clamp(14px, 2.5vw, 16px);
            color: #4a5568;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(min(160px, 45vw), 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        @media (max-width: 600px) {
            .cards-grid {
                grid-template-columns: repeat(auto-fill, minmax(min(140px, 90vw), 1fr));
                gap: 15px;
            }
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            perspective: 1000px;
            aspect-ratio: 3/4;
            position: relative;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .card.mastered {
            border: 3px solid #38a169;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 15px;
            border-radius: 12px;
        }

        .card-back {
            transform: rotateY(180deg);
            background: #f7fafc;
        }

        .card-text {
            font-size: clamp(12px, 2.5vw, 14px);
            font-weight: bold;
            margin-bottom: 15px;
            overflow-wrap: break-word;
            text-align: center;
            line-height: 1.4;
        }

        .card-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .card-btn {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        .mastered-btn {
            background: #38a169;
        }

        .review-btn {
            background: #e53e3e;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .page-btn {
            padding: 8px 16px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .page-btn.active {
            background: #667eea;
            color: white;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #667eea;
        }

        /* Mode selector styles */
        .mode-selector {
            max-width: 500px;
            margin: 30px auto;
            text-align: center;
        }

        .mode-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 20px;
            font-size: 18px;
            border-radius: 12px;
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .mode-btn:hover {
            background: #667eea;
            color: white;
        }

        .mode-btn span {
            font-size: 14px;
            margin-top: 5px;
            opacity: 0.8;
        }

        /* Learn screen styles */
        .learn-screen {
            margin: 20px 0;
        }

        .learn-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .words-table {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            margin: 20px 0;
        }

        .table-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            display: grid;
            grid-template-columns: 50px 1fr 1fr 80px;
            gap: 15px;
            font-weight: bold;
            align-items: center;
        }

        .table-row {
            padding: 15px;
            display: grid;
            grid-template-columns: 50px 1fr 1fr 80px;
            gap: 15px;
            border-bottom: 1px solid #e2e8f0;
            align-items: center;
            transition: background-color 0.2s;
        }

        /* Mobile responsive table styles */
        @media (max-width: 768px) {
            .words-table {
                margin: 10px 0;
            }

            .table-header {
                grid-template-columns: 40px 2fr 2fr 60px;
                padding: 12px;
                gap: 8px;
                font-size: 14px;
            }

            .table-row {
                grid-template-columns: 40px 2fr 2fr 60px;
                padding: 12px;
                gap: 8px;
            }

            .word-dutch, .word-english {
                font-size: 14px;
                line-height: 1.3;
                word-wrap: break-word;
                overflow-wrap: break-word;
            }

            .word-number {
                font-size: 12px;
            }

            .word-checkbox {
                width: 18px;
                height: 18px;
            }
        }

        @media (max-width: 480px) {
            .table-header {
                grid-template-columns: 35px 2.5fr 2.5fr 50px;
                padding: 10px;
                gap: 6px;
                font-size: 13px;
            }

            .table-row {
                grid-template-columns: 35px 2.5fr 2.5fr 50px;
                padding: 10px;
                gap: 6px;
            }

            .word-dutch, .word-english {
                font-size: 13px;
                line-height: 1.2;
            }

            .word-number {
                font-size: 11px;
            }

            .word-checkbox {
                width: 16px;
                height: 16px;
            }
        }

        .table-row:hover {
            background-color: #f8f9fa;
        }

        .table-row.completed {
            background-color: #f0fff4;
        }

        .word-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .word-number {
            font-weight: bold;
            color: #667eea;
        }

        .word-dutch {
            font-weight: bold;
            color: #4a5568;
        }

        .word-english {
            color: #718096;
        }

        .progress-bar {
            background: #e2e8f0;
            border-radius: 10px;
            height: 10px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            .game-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .controls {
                justify-content: center;
            }
            
            .days-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dutch-English Flipcard Game</h1>
        
        <!-- Setup Screen -->
        <div id="setupScreen" class="setup-screen">
            <div class="input-group">
                <label for="supabaseUrl">Supabase Project URL:</label>
                <input type="url" id="supabaseUrl" value="https://holrmoivprslloohveqg.supabase.co" required readonly>
            </div>
            
            <div class="input-group">
                <label for="supabaseKey">Supabase Anon Key:</label>
                <input type="text" id="supabaseKey" placeholder="Your anon key" required>
            </div>
            
            <div class="input-group">
                <label for="userId">Your User ID:</label>
                <input type="text" id="userId" placeholder="e.g., friend1" required>
            </div>
            
            <button id="connectBtn" class="connect-btn">Connect & Load Cards</button>
            
            <div id="errorMessage" class="error hidden"></div>
            <div id="successMessage" class="success hidden"></div>
        </div>

        <!-- Category Selection -->
        <div id="categorySelector" class="day-selector hidden">
            <h2 style="
    text-align: center;
    color: #7353ad;
">Select a Category to Practice</h2>
            <div id="categoriesGrid" class="days-grid"></div>
        </div>

        <!-- Mode Selection -->
        <div id="modeSelector" class="mode-selector hidden">
            <h2 id="selectedCategoryName">Select Learning Mode</h2>
            <div class="mode-buttons">
                <button id="learnModeBtn" class="mode-btn">
                    ðŸ“š Learn
                    <span>View words and meanings</span>
                </button>
                <button id="flipCardModeBtn" class="mode-btn">
                    ðŸŽ® Flip Cards
                    <span>Interactive flashcard game</span>
                </button>
            </div>
            <button id="backToCategoriesFromMode" style="margin-top: 20px;">Back to Categories</button>
        </div>

        <!-- Learn Screen -->
        <div id="learnScreen" class="learn-screen hidden">
            <div class="learn-header">
                <div>
                    <h2 id="learnCategoryTitle">Learning Category</h2>
                    <div id="learnProgress" class="progress-info"></div>
                </div>
                <div class="controls">
                    <button id="backToModeFromLearn">Back to Mode Selection</button>
                    <button id="clearLearnProgress">Clear Learn Progress</button>
                </div>
            </div>
            
            <div class="progress-bar">
                <div id="learnProgressBar" class="progress-fill" style="width: 0%"></div>
            </div>
            
            <div id="wordsTable" class="words-table">
                <div class="table-header">
                    <div>#</div>
                    <div>Dutch</div>
                    <div>English</div>
                    <div>Done</div>
                </div>
                <div id="tableRows"></div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="hidden">
            <div class="game-header">
                <div class="progress-info">
                    <div id="categoryProgress"></div>
                    <div id="totalProgress"></div>
                </div>
                <div class="controls">
                    <button id="backToCategories">Back to Categories</button>
                    <button id="resetCategoryProgress">Reset Category Progress</button>
                    <button id="resetAllProgress">Reset All Progress</button>
                </div>
            </div>
            
            <div id="cardsGrid" class="cards-grid"></div>
            <div id="pagination" class="pagination"></div>
        </div>

        <div id="loading" class="loading hidden">Loading...</div>
    </div>

    <script>
        class DutchFlipCardGame {
            constructor() {
                this.supabase = null;
                this.userId = '';
                this.cards = [];
                this.userProgress = new Map();
                this.currentCategory = null;
                this.currentPage = 1;
                this.cardsPerPage = 50;
                this.categories = [];
                
                this.initializeEventListeners();
            }

            initializeEventListeners() {
                document.getElementById('connectBtn').addEventListener('click', () => this.connect());
                document.getElementById('backToCategories').addEventListener('click', () => this.showCategorySelector());
                document.getElementById('resetCategoryProgress').addEventListener('click', () => this.resetProgress('category'));
                document.getElementById('resetAllProgress').addEventListener('click', () => this.resetProgress('all'));
                
                // Mode selector listeners
                document.getElementById('learnModeBtn').addEventListener('click', () => this.showLearnScreen());
                document.getElementById('flipCardModeBtn').addEventListener('click', () => this.showGameScreen());
                document.getElementById('backToCategoriesFromMode').addEventListener('click', () => this.showCategorySelector());
                
                // Learn screen listeners
                document.getElementById('backToModeFromLearn').addEventListener('click', () => this.showModeSelector());
                document.getElementById('clearLearnProgress').addEventListener('click', () => this.clearLearnProgress());
            }

            showError(message) {
                const errorEl = document.getElementById('errorMessage');
                errorEl.textContent = message;
                errorEl.classList.remove('hidden');
                setTimeout(() => errorEl.classList.add('hidden'), 5000);
            }

            showSuccess(message) {
                const successEl = document.getElementById('successMessage');
                successEl.textContent = message;
                successEl.classList.remove('hidden');
                setTimeout(() => successEl.classList.add('hidden'), 3000);
            }

            showLoading(show = true) {
                document.getElementById('loading').classList.toggle('hidden', !show);
            }

            async connect() {
                const url = document.getElementById('supabaseUrl').value.trim();
                const key = document.getElementById('supabaseKey').value.trim();
                const userId = document.getElementById('userId').value.trim();

                if (!url || !key || !userId) {
                    this.showError('Please fill in all fields.');
                    return;
                }

                try {
                    this.showLoading(true);
                    this.userId = userId;
                    this.supabase = supabase.createClient(url, key);

                    // Test connection by fetching cards
                    const { data: cards, error } = await this.supabase
                        .from('cards')
                        .select('*')
                        .limit(1);

                    if (error) {
                        throw new Error(`Database error: ${error.message}`);
                    }

                    await this.loadAllCards();
                    this.showSuccess('Connected successfully!');
                    this.showCategorySelector();
                    
                } catch (error) {
                    this.showError(`Connection failed: ${error.message}`);
                } finally {
                    this.showLoading(false);
                }
            }

            async loadAllCards() {
                try {
                    const { data: cards, error } = await this.supabase
                        .from('cards')
                        .select('*')
                        .order('id', { ascending: true });

                    if (error) throw error;

                    this.cards = cards || [];
                    if (this.cards.length === 0) {
                        throw new Error('No cards found in database. Please make sure the cards table is populated.');
                    }

                    // Extract unique categories
                    this.categories = [...new Set(this.cards.map(card => card.category))];

                } catch (error) {
                    throw new Error(`Failed to load cards: ${error.message}`);
                }
            }

            showCategorySelector() {
                document.getElementById('setupScreen').classList.add('hidden');
                document.getElementById('gameScreen').classList.add('hidden');
                document.getElementById('modeSelector').classList.add('hidden');
                document.getElementById('learnScreen').classList.add('hidden');
                document.getElementById('categorySelector').classList.remove('hidden');

                this.renderCategoryButtons();
            }

            renderCategoryButtons() {
                const categoriesGrid = document.getElementById('categoriesGrid');
                categoriesGrid.innerHTML = '';

                // Group cards by category to get counts
                const cardsByCategory = this.cards.reduce((acc, card) => {
                    acc[card.category] = (acc[card.category] || 0) + 1;
                    return acc;
                }, {});

                this.categories.forEach(category => {
                    const cardCount = cardsByCategory[category] || 0;
                    
                    const button = document.createElement('button');
                    button.className = 'day-btn';
                    button.innerHTML = `
                        <strong>${category}</strong><br>
                        <small>${cardCount} cards</small>
                    `;
                    button.addEventListener('click', () => this.selectCategory(category));
                    categoriesGrid.appendChild(button);
                });
            }

            async selectCategory(category) {
                this.currentCategory = category;
                this.currentPage = 1;
                
                try {
                    this.showLoading(true);
                    await this.loadUserProgress();
                    this.showModeSelector();
                } catch (error) {
                    this.showError(`Failed to load progress: ${error.message}`);
                } finally {
                    this.showLoading(false);
                }
            }

            showModeSelector() {
                document.getElementById('categorySelector').classList.add('hidden');
                document.getElementById('gameScreen').classList.add('hidden');
                document.getElementById('learnScreen').classList.add('hidden');
                document.getElementById('modeSelector').classList.remove('hidden');
                
                document.getElementById('selectedCategoryName').textContent = `${this.currentCategory} - Select Learning Mode`;
            }

            async loadUserProgress() {
                try {
                    const categoryCards = this.cards.filter(card => card.category === this.currentCategory);
                    const cardIds = categoryCards.map(card => card.id);

                    if (cardIds.length === 0) return;

                    const { data: progress, error } = await this.supabase
                        .from('progress')
                        .select('card_id, mastered')
                        .eq('user_id', this.userId)
                        .in('card_id', cardIds);

                    if (error) throw error;

                    this.userProgress.clear();
                    if (progress) {
                        progress.forEach(p => {
                            this.userProgress.set(p.card_id, p.mastered);
                        });
                    }

                } catch (error) {
                    throw new Error(`Failed to load user progress: ${error.message}`);
                }
            }

            showLearnScreen() {
                document.getElementById('modeSelector').classList.add('hidden');
                document.getElementById('gameScreen').classList.add('hidden');
                document.getElementById('learnScreen').classList.remove('hidden');

                this.renderLearnScreen();
            }

            showGameScreen() {
                document.getElementById('modeSelector').classList.add('hidden');
                document.getElementById('learnScreen').classList.add('hidden');
                document.getElementById('gameScreen').classList.remove('hidden');

                this.updateProgressDisplay();
                this.renderCards();
                this.renderPagination();
            }

            updateProgressDisplay() {
                const categoryCards = this.cards.filter(card => card.category === this.currentCategory);
                const categoryMastered = categoryCards.filter(card => this.userProgress.get(card.id) === true).length;
                const totalMastered = this.cards.filter(card => this.userProgress.get(card.id) === true).length;

                document.getElementById('categoryProgress').textContent = 
                    `${this.currentCategory} - ${categoryMastered}/${categoryCards.length} cards mastered`;
                // document.getElementById('totalProgress').textContent = 
                //     `Overall Progress: ${totalMastered}/${this.cards.length} cards mastered (~1300 total)`;
            }

            renderCards() {
                const cardsGrid = document.getElementById('cardsGrid');
                cardsGrid.innerHTML = '';

                const categoryCards = this.cards.filter(card => card.category === this.currentCategory);
                const startIndex = (this.currentPage - 1) * this.cardsPerPage;
                const endIndex = startIndex + this.cardsPerPage;
                const pageCards = categoryCards.slice(startIndex, endIndex);

                pageCards.forEach(card => {
                    const cardElement = this.createCardElement(card);
                    cardsGrid.appendChild(cardElement);
                });
            }

            createCardElement(card) {
                const isFlipped = this.userProgress.get(card.id) === true;
                const isMastered = this.userProgress.get(card.id) === true;

                const cardDiv = document.createElement('div');
                cardDiv.className = `card ${isMastered ? 'mastered' : ''}`;
                
                cardDiv.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">
                            <div class="card-text">${card.dutch}</div>
                        </div>
                        <div class="card-back">
                            <div class="card-text">${card.english}</div>
                            <div class="card-buttons">
                                <button class="card-btn mastered-btn" onclick="window.game.updateProgress(${card.id}, true)">Mastered</button>
                                <button class="card-btn review-btn" onclick="window.game.updateProgress(${card.id}, false)">Needs Review</button>
                            </div>
                        </div>
                    </div>
                `;

                // Add click event to flip the card
                cardDiv.addEventListener('click', (e) => {
                    // Don't flip if clicking on buttons
                    if (e.target.tagName === 'BUTTON') return;
                    cardDiv.classList.toggle('flipped');
                });

                return cardDiv;
            }

            async updateProgress(cardId, mastered) {
                try {
                    const { error } = await this.supabase
                        .from('progress')
                        .upsert({
                            user_id: this.userId,
                            card_id: cardId,
                            mastered: mastered
                        }, {
                            onConflict: 'user_id,card_id'
                        });

                    if (error) throw error;

                    this.userProgress.set(cardId, mastered);
                    this.updateProgressDisplay();
                    this.renderCards(); // Re-render to update visual indicators

                } catch (error) {
                    this.showError(`Failed to update progress: ${error.message}`);
                }
            }

            renderPagination() {
                const pagination = document.getElementById('pagination');
                pagination.innerHTML = '';

                const categoryCards = this.cards.filter(card => card.category === this.currentCategory);
                const totalPages = Math.ceil(categoryCards.length / this.cardsPerPage);

                if (totalPages <= 1) return;

                for (let page = 1; page <= totalPages; page++) {
                    const button = document.createElement('button');
                    button.className = `page-btn ${page === this.currentPage ? 'active' : ''}`;
                    button.textContent = page;
                    button.disabled = page === this.currentPage;
                    button.addEventListener('click', () => {
                        this.currentPage = page;
                        this.renderCards();
                        this.renderPagination();
                    });
                    pagination.appendChild(button);
                }
            }

            async resetProgress(type) {
                const confirmMessage = type === 'category' 
                    ? `Reset progress for ${this.currentCategory} category?`
                    : 'Reset ALL progress? This cannot be undone!';

                if (!confirm(confirmMessage)) return;

                try {
                    this.showLoading(true);

                    if (type === 'category') {
                        const categoryCards = this.cards.filter(card => card.category === this.currentCategory);
                        const cardIds = categoryCards.map(card => card.id);

                        const { error } = await this.supabase
                            .from('progress')
                            .delete()
                            .eq('user_id', this.userId)
                            .in('card_id', cardIds);

                        if (error) throw error;

                        // Update local progress
                        cardIds.forEach(id => this.userProgress.delete(id));
                        
                    } else {
                        const { error } = await this.supabase
                            .from('progress')
                            .delete()
                            .eq('user_id', this.userId);

                        if (error) throw error;

                        this.userProgress.clear();
                    }

                    this.updateProgressDisplay();
                    this.renderCards();
                    this.showSuccess(`Progress reset successfully!`);

                } catch (error) {
                    this.showError(`Failed to reset progress: ${error.message}`);
                } finally {
                    this.showLoading(false);
                }
            }

            // Learn mode methods
            renderLearnScreen() {
                const categoryCards = this.cards.filter(card => card.category === this.currentCategory);
                
                // Update title and progress
                document.getElementById('learnCategoryTitle').textContent = `Learn: ${this.currentCategory}`;
                this.updateLearnProgress();
                
                // Render table rows
                const tableRows = document.getElementById('tableRows');
                tableRows.innerHTML = '';
                
                categoryCards.forEach((card, index) => {
                    const isCompleted = this.getLearnProgress(card.id);
                    
                    const row = document.createElement('div');
                    row.className = `table-row ${isCompleted ? 'completed' : ''}`;
                    
                    row.innerHTML = `
                        <div class="word-number">${index + 1}</div>
                        <div class="word-dutch">${card.dutch}</div>
                        <div class="word-english">${card.english}</div>
                        <div>
                            <input 
                                type="checkbox" 
                                class="word-checkbox" 
                                ${isCompleted ? 'checked' : ''}
                                onchange="window.game.toggleLearnProgress(${card.id}, this.checked)"
                            />
                        </div>
                    `;
                    
                    tableRows.appendChild(row);
                });
            }

            getLearnProgress(cardId) {
                const key = `learn_${this.userId}_${this.currentCategory}_${cardId}`;
                return localStorage.getItem(key) === 'true';
            }

            setLearnProgress(cardId, completed) {
                const key = `learn_${this.userId}_${this.currentCategory}_${cardId}`;
                if (completed) {
                    localStorage.setItem(key, 'true');
                } else {
                    localStorage.removeItem(key);
                }
            }

            toggleLearnProgress(cardId, completed) {
                this.setLearnProgress(cardId, completed);
                this.updateLearnProgress();
                this.renderLearnScreen(); // Re-render to update row styling
            }

            updateLearnProgress() {
                const categoryCards = this.cards.filter(card => card.category === this.currentCategory);
                const completedCount = categoryCards.filter(card => this.getLearnProgress(card.id)).length;
                const totalCount = categoryCards.length;
                const percentage = totalCount > 0 ? (completedCount / totalCount) * 100 : 0;
                
                // Update progress text
                document.getElementById('learnProgress').textContent = 
                    `${completedCount}/${totalCount} words learned (${Math.round(percentage)}%)`;
                
                // Update progress bar
                document.getElementById('learnProgressBar').style.width = `${percentage}%`;
            }

            clearLearnProgress() {
                if (!confirm(`Clear all learn progress for ${this.currentCategory}? This cannot be undone!`)) {
                    return;
                }
                
                const categoryCards = this.cards.filter(card => card.category === this.currentCategory);
                categoryCards.forEach(card => {
                    this.setLearnProgress(card.id, false);
                });
                
                this.updateLearnProgress();
                this.renderLearnScreen();
                this.showSuccess('Learn progress cleared successfully!');
            }
        }

        // Initialize the game
        window.game = new DutchFlipCardGame();

        if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('Service Worker registered:', registration);
                })
                .catch(error => {
                    console.error('Service Worker registration failed:', error);
                });
        });
    }
    </script>
    
</body>
</html>